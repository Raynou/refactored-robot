{"version":3,"file":"camera.min.js","sources":["../src/camera.js"],"sourcesContent":["/**\r\n * Saves the image\r\n * @param {video} video - The camera feedback\r\n * @param {canvas} canvas - The canvas where the image will be temporally saved\r\n * @param {string} title The title of the page where the photo is taken\r\n * @param {number} userId The id of the user\r\n */\r\nconst saveImage = (video, canvas, title, userId) => {\r\n    canvas.getContext(\"2d\").drawImage(video, 0, 0, canvas.width, canvas.height);\r\n    const date = new Date();\r\n    const formatMinutes = (minutes) => {\r\n        const stringMinutes = minutes.toString();\r\n        if (stringMinutes.length === 1) {\r\n            return \"0\" + stringMinutes;\r\n        }\r\n        return stringMinutes;\r\n    };\r\n\r\n    const time = `${date.getHours()}:${formatMinutes(date.getMinutes())}`;\r\n    const body = {\r\n        photo: canvas.toDataURL(),\r\n        page: title,\r\n        userId: userId,\r\n        time: time,\r\n    };\r\n\r\n    fetch(\"/moodle/blocks/simplecamera/api.php\", {\r\n        method: \"POST\",\r\n        mode: \"no-cors\",\r\n        headers: {\r\n            \"Content-type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(body),\r\n    });\r\n};\r\n\r\n/**\r\n * Get the current time value from local storage\r\n * @returns {number} A number that represents time.\r\n */\r\nconst getFromLocalStorage = () => {\r\n    return parseInt(localStorage.getItem(\"timeTranscurred\"));\r\n};\r\n\r\n/**\r\n * Put a value of the local storage.\r\n * @param {number} seconds A number which represents the time transcurred in the timer\r\n */\r\nconst pushToLocalStorage = (seconds) => {\r\n    localStorage.setItem(\"timeTranscurred\", seconds.toString());\r\n};\r\n\r\nexport const init = (timer, title, id) => {\r\n    let video = document.querySelector(\"#camera\");\r\n    let canvas = document.querySelector(\"#canvas\");\r\n    let saveButton = document.querySelector(\"#save_button\");\r\n    navigator.mediaDevices.getUserMedia({ video: true, audio: false })\r\n        .then((stream) => {\r\n            video.srcObject = stream;\r\n            video.play();\r\n        })\r\n        .catch((error) => window.alert(error));\r\n\r\n    saveButton.addEventListener(\"click\", () => {\r\n        saveImage(video, canvas);\r\n    });\r\n\r\n    if (getFromLocalStorage() === null || isNaN(getFromLocalStorage())) {\r\n        pushToLocalStorage(0);\r\n    }\r\n\r\n    setInterval(() => {\r\n        if (getFromLocalStorage() === timer / 1000) {\r\n            saveImage(video, canvas, title, id);\r\n            pushToLocalStorage(0);\r\n        } else {\r\n            pushToLocalStorage(getFromLocalStorage() + 1);\r\n        }\r\n    }, 1000);\r\n};\r\n"],"names":["saveImage","video","canvas","title","userId","getContext","drawImage","width","height","date","Date","time","getHours","minutes","stringMinutes","toString","length","formatMinutes","getMinutes","body","photo","toDataURL","page","fetch","method","mode","headers","JSON","stringify","getFromLocalStorage","parseInt","localStorage","getItem","pushToLocalStorage","seconds","setItem","timer","id","document","querySelector","saveButton","navigator","mediaDevices","getUserMedia","audio","then","stream","srcObject","play","catch","error","window","alert","addEventListener","isNaN","setInterval"],"mappings":"sJAOMA,UAAY,CAACC,MAAOC,OAAQC,MAAOC,UACrCF,OAAOG,WAAW,MAAMC,UAAUL,MAAO,EAAG,EAAGC,OAAOK,MAAOL,OAAOM,cAC9DC,KAAO,IAAIC,KASXC,eAAUF,KAAKG,uBAREC,CAAAA,gBACbC,cAAgBD,QAAQE,kBACD,IAAzBD,cAAcE,OACP,IAAMF,cAEVA,eAGwBG,CAAcR,KAAKS,eAChDC,KAAO,CACTC,MAAOlB,OAAOmB,YACdC,KAAMnB,MACNC,OAAQA,OACRO,KAAMA,MAGVY,MAAM,sCAAuC,CACzCC,OAAQ,OACRC,KAAM,UACNC,QAAS,gBACW,oBAEpBP,KAAMQ,KAAKC,UAAUT,SAQvBU,oBAAsB,IACjBC,SAASC,aAAaC,QAAQ,oBAOnCC,mBAAsBC,UACxBH,aAAaI,QAAQ,kBAAmBD,QAAQnB,2BAGhC,CAACqB,MAAOjC,MAAOkC,UAC3BpC,MAAQqC,SAASC,cAAc,WAC/BrC,OAASoC,SAASC,cAAc,WAChCC,WAAaF,SAASC,cAAc,gBACxCE,UAAUC,aAAaC,aAAa,CAAE1C,OAAO,EAAM2C,OAAO,IACrDC,MAAMC,SACH7C,MAAM8C,UAAYD,OAClB7C,MAAM+C,UAETC,OAAOC,OAAUC,OAAOC,MAAMF,SAEnCV,WAAWa,iBAAiB,SAAS,KACjCrD,UAAUC,MAAOC,YAGS,OAA1B2B,uBAAkCyB,MAAMzB,yBACxCI,mBAAmB,GAGvBsB,aAAY,KACJ1B,wBAA0BO,MAAQ,KAClCpC,UAAUC,MAAOC,OAAQC,MAAOkC,IAChCJ,mBAAmB,IAEnBA,mBAAmBJ,sBAAwB,KAEhD"}